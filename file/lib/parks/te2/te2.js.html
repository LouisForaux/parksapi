<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">lib/parks/te2/te2.js | @themeparks/parksapi</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/ThemeParks/parksapi"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/configBase.js~ConfigBase.html">ConfigBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCache">getCache</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-parseConfig">parseConfig</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-reusePromise">reusePromise</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-reusePromiseForever">reusePromiseForever</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#cache">cache</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/cache/cacheBase.js~CacheBase.html">CacheBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/cache/cacheLevel.js~CacheLevel.html">CacheLevel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/cache/cacheLmdb.js~CacheLmdb.html">CacheLmdb</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/cache/cacheMemory.js~CacheMemory.html">CacheMemory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/cache/scopedCache.js~ScopedCache.html">ScopedCache</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks">parks</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/database.js~Database.html">Database</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/destination.js~Destination.html">Destination</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/entity.js~Entity.html">Entity</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/park.js~Park.html">Park</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-HTTP">HTTP</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateRandomAndroidUseragent">generateRandomAndroidUseragent</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-setOverrideFunction">setOverrideFunction</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getLiveDataErrors">getLiveDataErrors</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-validateEntitySchedule">validateEntitySchedule</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Sieve">Sieve</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getValidTagObject">getValidTagObject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isSimpleTagType">isSimpleTagType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isValidTag">isValidTag</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isValidTagType">isValidTagType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-attractionType">attractionType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-boardingGroupState">boardingGroupState</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-entityType">entityType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-queueType">queueType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-returnTimeState">returnTimeState</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-scheduleType">scheduleType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-statusType">statusType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-tagType">tagType</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-attractionsio">parks/attractionsio</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/attractionsio/attractionsio.js~AltonTowers.html">AltonTowers</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/attractionsio/attractionsio.js~AttractionsIO.html">AttractionsIO</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/attractionsio/attractionsio.js~ChessingtonWorldOfAdventures.html">ChessingtonWorldOfAdventures</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/attractionsio/attractionsio.js~Gardaland.html">Gardaland</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/attractionsio/attractionsio.js~HeidePark.html">HeidePark</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/attractionsio/attractionsio.js~LegolandOrlando.html">LegolandOrlando</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/attractionsio/attractionsio.js~LegolandWindsor.html">LegolandWindsor</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/attractionsio/attractionsio.js~ThorpePark.html">ThorpePark</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-efteling">parks/efteling</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/efteling/efteling.js~Efteling.html">Efteling</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-europa">parks/europa</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/europa/europapark.js~EuropaPark.html">EuropaPark</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/europa/europaparkdb.js~DatabaseEuropaPark.html">DatabaseEuropaPark</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-herschend">parks/herschend</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/herschend/herschendparks.js~Dollywood.html">Dollywood</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/herschend/herschendparks.js~HerschendDestination.html">HerschendDestination</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/herschend/herschendparks.js~SilverDollarCity.html">SilverDollarCity</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-hershey">parks/hershey</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/hershey/hersheypark.js~Hersheypark.html">Hersheypark</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-liseberg">parks/liseberg</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/liseberg/liseberg.js~Liseberg.html">Liseberg</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-parcasterix">parks/parcasterix</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/parcasterix/parcasterix.js~ParcAsterix.html">ParcAsterix</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-phantasialand">parks/phantasialand</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/phantasialand/phantasialand.js~Phantasialand.html">Phantasialand</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-plopsaland">parks/plopsaland</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/plopsaland/plopsa.js~HolidayPark.html">HolidayPark</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/plopsaland/plopsa.js~PlopsaBase.html">PlopsaBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/plopsaland/plopsa.js~Plopsaland.html">Plopsaland</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-sixflags">parks/sixflags</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/sixflags/sixflags.js~SixFlags.html">SixFlags</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-tdr">parks/tdr</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/tdr/tokyodisneyresort.js~TokyoDisneyResort.html">TokyoDisneyResort</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-te2">parks/te2</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/te2/te2.js~CaliforniasGreatAmerica.html">CaliforniasGreatAmerica</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/te2/te2.js~CanadasWonderland.html">CanadasWonderland</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/te2/te2.js~Carowinds.html">Carowinds</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/te2/te2.js~CedarPoint.html">CedarPoint</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/te2/te2.js~DorneyPark.html">DorneyPark</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/te2/te2.js~KingsDominion.html">KingsDominion</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/te2/te2.js~KingsIsland.html">KingsIsland</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/te2/te2.js~KnottsBerryFarm.html">KnottsBerryFarm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/te2/te2.js~MichigansAdventure.html">MichigansAdventure</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/te2/te2.js~TE2Destination.html">TE2Destination</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/te2/te2.js~ValleyFair.html">ValleyFair</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/te2/te2.js~WorldsOfFun.html">WorldsOfFun</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-toverland">parks/toverland</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/toverland/toverland.js~Toverland.html">Toverland</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-universal">parks/universal</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/universal/universal.js~UniversalOrlando.html">UniversalOrlando</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/universal/universal.js~UniversalResortBase.html">UniversalResortBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/universal/universal.js~UniversalStudios.html">UniversalStudios</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/universal/universalstudios.js~UniversalIslandsOfAdventure.html">UniversalIslandsOfAdventure</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/universal/universalstudios.js~UniversalParkBase.html">UniversalParkBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/universal/universalstudios.js~UniversalStudios.html">UniversalStudios</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/universal/universalstudios.js~UniversalStudiosFlorida.html">UniversalStudiosFlorida</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/universal/universalstudios.js~UniversalVolcanoBay.html">UniversalVolcanoBay</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#parks-wdw">parks/wdw</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/wdw/waltdisneyworldbase.js~DisneyLiveResort.html">DisneyLiveResort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/wdw/waltdisneyworldbase.js~DisneylandResort.html">DisneylandResort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/wdw/waltdisneyworldbase.js~HongKongDisneyland.html">HongKongDisneyland</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/wdw/waltdisneyworldbase.js~WaltDisneyWorldResort.html">WaltDisneyWorldResort</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/wdw/wdwdatabase.js~DatabaseWDW.html">DatabaseWDW</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/lib/parks/wdw/wdwdb.js~IndexedWDWDB.html">IndexedWDWDB</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getDatabase">getDatabase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getEntityID">getEntityID</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">lib/parks/te2/te2.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">// te2.io / te2.biz interface

import {Destination} from &apos;../destination.js&apos;;
import {attractionType, statusType, queueType, tagType, scheduleType, entityType} from &apos;../parkTypes.js&apos;;
import {URL} from &apos;url&apos;;

export class TE2Destination extends Destination {
  constructor(options = {}) {
    // venue ID
    options.destinationId = options.destinationId || &apos;&apos;;
    options.venueId = options.venueId || &apos;&apos;;
    options.subdomain = options.subdomain || &apos;cf&apos;;
    options.apidomain = options.apidomain || &apos;te2.biz&apos;;
    options.apiuser = options.apiuser || &apos;&apos;;
    options.apipass = options.apipass || &apos;&apos;;
    options.rideTypes = options.rideTypes || [&apos;Ride&apos;, &apos;Coasters&apos;, &apos;Family&apos;, &apos;ThrillRides&apos;, &apos;Kids&apos;, &apos;Rides &amp; Attractions&apos;];
    options.diningTypes = options.diningTypes || [&apos;Snacks&apos;, &apos;wpDining&apos;, &apos;Meals&apos;, &apos;Dining&apos;];

    options.configPrefixes = [&apos;TE2&apos;];

    super(options);

    if (!this.config.destinationId) throw new Error(&apos;Missing destinationId&apos;);
    if (!this.config.venueId) throw new Error(&apos;Missing venueId&apos;);
    if (!this.config.subdomain) throw new Error(&apos;Missing subdomain&apos;);
    if (!this.config.apidomain) throw new Error(&apos;Missing apidomain&apos;);
    if (!this.config.apiuser) throw new Error(&apos;Missing apiuser&apos;);
    if (!this.config.apipass) throw new Error(&apos;Missing apipass&apos;);
    if (!this.config.rideTypes) throw new Error(&apos;Missing rideTypes&apos;);

    // construct our destination&apos;s API base URL from the configured pieces
    this.config.apiBase = this.config.apiBase || `https://${this.config.subdomain}.${this.config.apidomain}`;

    // authenticate all our requests
    const baseURLHostname = new URL(this.config.apiBase).hostname;

    this.http.injectForDomain({
      hostname: baseURLHostname,
    }, async (method, url, data, options) =&gt; {
      // extract path from url
      const path = new URL(url).pathname;

      // add core headers
      options.headers = {
        ...options.headers,
        &apos;Content-Type&apos;: &apos;application/json&apos;,
      };

      // use username:password credentials for /rest/ requests
      if (path.startsWith(&apos;/rest/&apos;)) {
        options.headers = {
          ...options.headers,
          Authorization: `Basic ${Buffer.from(`${this.config.apiuser}:${this.config.apipass}`).toString(&apos;base64&apos;)}`,
        };
      }
    });
  }

  /**
   * Get current POI data status
   * @returns {array&lt;object&gt;}
   */
  async getPOIStatus() {
    &apos;@cache|1&apos;;
    const resp = await this.http(&apos;GET&apos;, `${this.config.apiBase}/rest/venue/${this.config.venueId}/poi/all/status`);
    return resp.body;
  }

  /**
   * Get the destination data from the API (name, location, etc.)
   * @returns {object}
   */
  async getDestinationData() {
    // cache for a day
    &apos;@cache|1440&apos;;
    const resp = await this.http(&apos;GET&apos;, `${this.config.apiBase}/rest/venue/${this.config.venueId}`);
    return resp.body;
  }

  /**
   * Get park POI data
   * @returns {array&lt;object&gt;}
   */
  async getPOIData() {
    // cache for a day
    &apos;@cache|1440&apos;;
    const resp = await this.http(&apos;GET&apos;, `${this.config.apiBase}/rest/venue/${this.config.venueId}/poi/all`);
    return resp.body;
  }

  /**
   * Fetch the POI category data for this destination
   */
  async _fetchCategories() {
    &apos;@cache|1440&apos;; // cache for a day
    const resp = await this.http(&apos;GET&apos;, `${this.config.apiBase}/rest/app/${this.config.venueId}/displayCategories`);
    return resp.body;
  }

  /**
   * Get categories from API based on the configured initial types
   * @param {object} params
   * @param {array&lt;string&gt;} params.initialTypes
   * @returns {object} - {types: {string: string}, entities: {string: string}}
   */
  async _getParsedCategories({initialTypes}) {
    const types = [].concat(...initialTypes);
    // some categories just list the POIs that belong to it
    const entities = [];

    const categoryData = await this._fetchCategories();

    categoryData.categories.forEach((cat) =&gt; {
      if (types.indexOf(cat.label) &gt;= 0) {
        if (types.indexOf(cat.id) &lt; 0) {
          types.push(cat.id);
        }
        if (cat.poi) {
          entities.push(...cat.poi);
        }
      }
      if (cat.parent &amp;&amp; types.indexOf(cat.parent) &gt;= 0) {
        if (types.indexOf(cat.id) &lt; 0) {
          types.push(cat.id);
        }
        if (cat.poi) {
          entities.push(...cat.poi);
        }
      }
    });

    return {
      types,
      entities: entities.filter((x, idx) =&gt; {
        // remove duplicates
        return entities.indexOf(x) === idx;
      }),
    };
  }

  /**
   * Get the type IDs for this destination&apos;s attractions
   */
  async getAttractionTypes() {
    return await this._getParsedCategories({
      initialTypes: this.config.rideTypes,
    });
  }

  /**
   * Get the type IDs for this destination&apos;s dining
   */
  async getDiningTypes() {
    return await this._getParsedCategories({
      initialTypes: this.config.diningTypes,
    });
  }

  /**
   * Helper function to build a basic entity document
   * Useful to avoid copy/pasting
   * @param {object} data 
   * @returns {object}
   */
  buildBaseEntityObject(data) {
    const entity = Destination.prototype.buildBaseEntityObject.call(this, data);

    if (data) {
      // name
      entity.name = data.name || data.label;

      entity._id = data.id || undefined;

      // entity location
      if (data.location) {
        if (data.location.lon) {
          entity.location = {
            longitude: data.location.lon,
            latitude: data.location.lat,
          };
        }
        if (data.location.center?.lon) {
          entity.location = {
            longitude: data.location.center.lon,
            latitude: data.location.center.lat,
          };
        }
      }
    }

    return entity;
  }

  /**
   * Build the destination entity representing this destination
   */
  async buildDestinationEntity() {
    const destinationData = await this.getDestinationData();
    return {
      ...this.buildBaseEntityObject(destinationData),
      _id: `${this.config.destinationId}_destination`,
      slug: this.config.destinationId,
      entityType: entityType.destination,
    };
  }

  /**
   * Build the park entities for this destination
   */
  async buildParkEntities() {
    const destinationData = await this.getDestinationData();
    return [
      {
        ...this.buildBaseEntityObject(destinationData),
        _id: this.config.destinationId,
        _destinationId: `${this.config.destinationId}_destination`,
        _parentId: `${this.config.destinationId}_destination`,
        slug: `${this.config.destinationId}park`,
        entityType: entityType.park,
      }
    ];
  }

  async _getFilteredEntities({types, entities}, data) {
    const poi = await this.getPOIData();
    return poi.filter((entry) =&gt; {
      // filter by rideTypes
      return types.indexOf(entry.type) &gt;= 0 || entities.indexOf(entry.id) &gt;= 0;
    }).map((entry) =&gt; {
      // build the entity
      return {
        ...this.buildBaseEntityObject(entry),
        _destinationId: `${this.config.destinationId}_destination`,
        _parentId: this.config.destinationId,
        _parkId: this.config.destinationId,
        ...data,
      };
    });
  }

  /**
   * Build the attraction entities for this destination
   */
  async buildAttractionEntities() {
    return await this._getFilteredEntities(
      {
        ...await this.getAttractionTypes(),
      },
      {
        entityType: entityType.attraction,
        attractionType: attractionType.ride,
      }
    );
  }

  /**
   * Build the show entities for this destination
   */
  async buildShowEntities() {
    return [];
  }

  /**
   * Build the restaurant entities for this destination
   */
  async buildRestaurantEntities() {
    return await this._getFilteredEntities(
      {
        ...await this.getDiningTypes(),
      },
      {
        entityType: entityType.restaurant,
      }
    );
  }

  /**
   * @inheritdoc
   */
  async buildEntityLiveData() {
    const statusData = await this.getPOIStatus();

    return statusData.map((entry) =&gt; {
      if (!entry.status || !entry.id) return null;

      if (entry.id.indexOf(&apos;_STANDING_OFFER_BEACON&apos;) &gt;= 0) {
        return null;
      }

      const liveData = {
        _id: entry.id,
        status: statusType.closed,
      };

      if (!!entry.status.isOpen) {
        liveData.status = statusType.operating;
      }

      if (entry.status.waitTime !== undefined) {
        liveData.queue = {
          [queueType.standBy]: {
            waitTime: entry.status.waitTime,
          },
        };
      }

      return liveData;
    }).filter((x) =&gt; !!x);
  }

  /**
   * Get schedule data for this destination, with an optional number of days to fetch
   * @param {object} [options]
   * @param {number} [options.days] Number of days to fetch
   * @returns {array&lt;object&gt;}
   */
  async _fetchScheduleData({days = 120} = {}) {
    &apos;@cache|1440&apos;; // cache for a day
    const resp = await this.http(&apos;GET&apos;, `${this.config.apiBase}/v2/venues/${this.config.venueId}/venue-hours?days=${days}`);
    return resp.body;
  }

  /**
   * Return schedule data for all scheduled entities in this destination
   * Eg. parks
   * @returns {array&lt;object&gt;}
   */
  async buildEntityScheduleData() {
    const scheduleData = await this._fetchScheduleData();

    const schedules = [];
    scheduleData.days.forEach((x) =&gt; {
      x.hours.forEach((hours) =&gt; {
        if (x.label !== &apos;Park&apos; &amp;&amp; hours.status === &apos;CLOSED&apos;) return;

        schedules.push({
          date: x.date,
          type: hours.label === &apos;Park&apos; ? &quot;OPERATING&quot; : &quot;INFO&quot;,
          description: hours.label === &apos;Park&apos; ? undefined : hours.label,
          // bless you, API developer, for having the dates in a normal format
          openingTime: hours.schedule.start,
          closingTime: hours.schedule.end,
        });
      });
    });

    return [
      {
        _id: this.config.destinationId,
        schedule: schedules,
      }
    ];
  }
}

export class CedarPoint extends TE2Destination {
  constructor(options = {}) {
    options.timezone = &apos;America/New_York&apos;;
    options.venueId = &apos;CF_CP&apos;;
    options.destinationId = &apos;cedarpoint&apos;;

    super(options);
  }
}

export class KnottsBerryFarm extends TE2Destination {
  constructor(options = {}) {
    options.timezone = &apos;America/Los_Angeles&apos;;
    options.venueId = &apos;CF_KBF&apos;;
    options.destinationId = &apos;knottsberryfarm&apos;;

    super(options);
  }
}

export class CaliforniasGreatAmerica extends TE2Destination {
  constructor(options = {}) {
    options.timezone = &apos;America/Los_Angeles&apos;;
    options.venueId = &apos;CF_GA&apos;;
    options.destinationId = &apos;californiasgreatamerica&apos;;

    super(options);
  }
}

export class CanadasWonderland extends TE2Destination {
  constructor(options = {}) {
    options.timezone = &apos;America/Toronto&apos;;
    options.venueId = &apos;CF_CW&apos;;
    options.destinationId = &apos;canadaswonderland&apos;;

    super(options);
  }
}

export class Carowinds extends TE2Destination {
  constructor(options = {}) {
    options.timezone = &apos;America/New_York&apos;;
    options.venueId = &apos;CF_CA&apos;;
    options.destinationId = &apos;carowinds&apos;;

    super(options);
  }
}

export class KingsIsland extends TE2Destination {
  constructor(options = {}) {
    options.timezone = &apos;America/New_York&apos;;
    options.venueId = &apos;CF_KI&apos;;
    options.destinationId = &apos;kingsisland&apos;;

    super(options);
  }
}

export class DorneyPark extends TE2Destination {
  constructor(options = {}) {
    options.timezone = &apos;America/New_York&apos;;
    options.venueId = &apos;CF_DP&apos;;
    options.destinationId = &apos;dorneypark&apos;;

    super(options);
  }
}

export class KingsDominion extends TE2Destination {
  constructor(options = {}) {
    options.timezone = &apos;America/New_York&apos;;
    options.venueId = &apos;CF_KD&apos;;
    options.destinationId = &apos;kingsdominion&apos;;

    super(options);
  }
}

export class MichigansAdventure extends TE2Destination {
  constructor(options = {}) {
    options.timezone = &apos;America/Detroit&apos;;
    options.venueId = &apos;CF_MA&apos;;
    options.destinationId = &apos;michigansadventure&apos;;

    super(options);
  }
}

export class ValleyFair extends TE2Destination {
  constructor(options = {}) {
    options.timezone = &apos;America/Chicago&apos;;
    options.venueId = &apos;CF_VF&apos;;
    options.destinationId = &apos;valleyfair&apos;;

    super(options);
  }
}

export class WorldsOfFun extends TE2Destination {
  constructor(options = {}) {
    options.timezone = &apos;America/Chicago&apos;;
    options.venueId = &apos;CF_WF&apos;;
    options.destinationId = &apos;worldsoffun&apos;;

    super(options);
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
